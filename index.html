<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Input</title>
</head>
<body>
  <h3>Listening...</h3>

  <script>
    function startDictation() {
      if (!('webkitSpeechRecognition' in window)) {
        try {
          window.opener?.postMessage({ type: 'error', message: 'Speech recognition not supported' }, '*');
        } catch (e) {
          console.error("Unable to send error to parent", e);
        }
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        try {
          window.opener?.postMessage({ type: 'voice-result', transcript }, '*');
        } catch (e) {
          console.error("Failed to send voice result", e);
        }
        window.close();
      };

      recognition.onerror = function(event) {
        try {
          window.opener?.postMessage({ type: 'voice-error', message: event.error }, '*');
        } catch (e) {
          console.error("Failed to send voice error", e);
        }
        window.close();
      };

      recognition.start();
    }

    startDictation();
  </script>
</body>
</html>
